# 支出入力画面詳細設計

## 1. 画面遷移フロー

### 1.1 基本フロー
```
ホーム画面
↓ (支出登録ボタンタップ)
支出登録画面
├── 金額入力 (必須)
├── カテゴリ選択 (必須)
├── サブカテゴリ選択 (オプション)
├── 日付選択 (デフォルト：今日)
├── メモ入力 (オプション)
└── 登録実行
↓
登録完了
↓ (自動遷移)
ホーム画面
```

### 1.2 カレンダーからの入力フロー
```
カレンダー画面
↓ (任意の日付をタップ)
支出登録画面 (選択した日付がプリセット)
├── 金額入力 (必須)
├── カテゴリ選択 (必須)
├── サブカテゴリ選択 (オプション)
├── 日付 (カレンダーで選択した日付)
├── メモ入力 (オプション)
└── 登録実行
↓
登録完了
↓ (自動遷移)
カレンダー画面 (元の画面に戻る)
```

### 1.3 入力順序の最適化
**推奨入力順序**：
1. **金額** → 2. **カテゴリ** → 3. **その他詳細** → 4. **登録**

**理由**：買い物直後の利用を想定し、金額（レシート確認）→カテゴリ（分類）の順が自然

## 2. 金額入力の詳細設計

### 2.1 テンキーレイアウト
```
┌─────────────────────────┐
│     ¥1,234             │ ← 入力中の金額表示
├─────────────────────────┤
│  [1]   [2]   [3]       │
│  [4]   [5]   [6]       │
│  [7]   [8]   [9]       │
│  [00]  [0]   [⌫]       │
└─────────────────────────┘
```

### 2.2 金額入力仕様
- **表示形式**：3桁区切りカンマ表示（¥1,234）
- **最大桁数**：8桁（99,999,999円）
- **小数点**：不要（円単位のみ）
- **初期状態**：¥0表示
- **削除機能**：⌫ボタンで1桁ずつ削除
- **全削除**：⌫ボタン長押しで全削除

### 2.3 金額入力時のバリデーション
- **リアルタイム**：入力中に即座にフォーマット
- **エラー状態**：
  - 0円：「金額を入力してください」
  - 上限超過：「金額が大きすぎます」（赤字表示）
- **警告表示**：10万円以上で「高額な支出です」（黄色表示）

## 3. カテゴリ選択の詳細設計

### 3.1 カテゴリ選択UI
```
┌─────┬─────┬─────┬─────┐
│ 🍽️  │ 🎮  │ 🚗  │ ⚡  │
│食費 │娯楽 │交通 │光熱│
├─────┼─────┼─────┼─────┤
│ 🏥  │ 👕  │ 📚  │ ➕  │
│医療 │衣服 │教育 │追加 │
└─────┴─────┴─────┴─────┘
```

### 3.2 カテゴリ選択仕様
- **表示形式**：4列グリッドレイアウト
- **アイコン**：Material Design Icons使用
- **サイズ**：各ボタン80px × 80px（スマホ）
- **選択状態**：選択中はプライマリ色でハイライト
- **並び順**：使用頻度順（学習機能で最適化）

### 3.3 サブカテゴリ選択
```
食費を選択時：
┌─────────────────────────┐
│ 🍽️ 食費                │
├─────────────────────────┤
│ [外食]  [食材]  [その他] │
└─────────────────────────┘
```

- **表示タイミング**：メインカテゴリ選択後に展開
- **スキップ可能**：サブカテゴリ未選択でも登録可能
- **デフォルト**：「その他」が自動選択される

### 3.4 新しいカテゴリ追加
```
➕ボタンタップ時：
┌─────────────────────────┐
│ 新しいカテゴリ           │
├─────────────────────────┤
│ カテゴリ名: [______]    │
│ アイコン: [🏷️ ▼]      │
│ [キャンセル] [追加]     │
└─────────────────────────┘
```

## 4. 日付選択の詳細設計

### 4.1 日付入力UI
```
┌─────────────────────────┐
│ 📅 2024/01/20 (今日)   │ ← デフォルト表示
└─────────────────────────┘
```

### 4.2 日付選択仕様
- **デフォルト**：
  - 通常の入力：現在日付
  - カレンダーからの入力：選択した日付
- **選択方法**：タップでカレンダー表示
- **範囲制限**：過去1年〜今日まで
- **クイック選択**：昨日、一昨日のボタン
- **未来日付**：選択可能だが警告表示
- **カレンダー連携**：カレンダー画面からの直接入力に対応

### 4.3 カレンダー表示
```
┌─────────────────────────┐
│     < 2024年1月 >       │
├─────────────────────────┤
│ 日 月 火 水 木 金 土     │
│    1  2  3  4  5  6     │
│ 7  8  9 10 11 12 13     │
│14 15 16 17 18 19 ●20    │ ← 選択中
│21 22 23 24 25 26 27     │
│28 29 30 31              │
├─────────────────────────┤
│ [昨日] [一昨日] [今日]  │
│ [キャンセル]   [確定]   │
└─────────────────────────┘
```

## 5. メモ入力の詳細設計

### 5.1 メモ入力UI
```
┌─────────────────────────┐
│ 💬 メモ (オプション)     │
├─────────────────────────┤
│ [コンビニ弁当________]   │
│                         │
│ [🎤] [定型文 ▼]         │ ← 音声入力・定型文
└─────────────────────────┘
```

### 5.2 メモ入力仕様
- **文字数制限**：100文字以内
- **入力方法**：
  - 手動入力
  - 音声入力（🎤ボタン）
  - 定型文選択（よく使う文言）
- **定型文例**：「コンビニ弁当」「ガソリン代」「映画鑑賞」

### 5.3 音声入力機能
- **起動**：🎤ボタンタップ
- **認識範囲**：10秒間
- **エラー処理**：認識失敗時は手動入力に切り替え
- **プライバシー**：音声データは端末内処理のみ

## 6. バリデーション・エラーハンドリング

### 6.1 リアルタイムバリデーション
```
[必須項目チェック]
金額: ✅ ¥1,200
カテゴリ: ❌ 未選択 → 「カテゴリを選択してください」

[登録ボタン状態]
すべて有効: [登録] (青色、タップ可能)
エラーあり: [登録] (グレー、タップ不可)
```

### 6.2 エラーメッセージ設計
- **表示位置**：該当項目の直下
- **表示色**：エラー色（#F44336）
- **メッセージ例**：
  - 「金額を入力してください」
  - 「カテゴリを選択してください」
  - 「メモが長すぎます（100文字以内）」

### 6.3 登録処理中の状態管理
```
[登録ボタンタップ後]
1. ボタンを無効化 (重複送信防止)
2. ローディング表示
3. 成功時: ホーム画面に自動遷移 + 成功メッセージ
4. 失敗時: エラーメッセージ表示 + ボタン再有効化
```

## 7. 一時保存・下書き機能

### 7.1 自動保存タイミング
- **金額入力完了時**：3秒後に自動保存
- **カテゴリ選択時**：即座に保存
- **画面離脱時**：現在の入力状態を保存

### 7.2 下書き復元
```
[アプリ再起動時]
下書きあり:
┌─────────────────────────┐
│ 未完了の入力があります   │
│ ¥1,200 食費 1/20       │
│ [破棄] [続きから入力]   │
└─────────────────────────┘
```

### 7.3 下書き管理
- **保存期間**：24時間
- **保存件数**：1件のみ（最新で上書き）
- **削除タイミング**：登録完了時、手動破棄時

## 8. アクセシビリティ対応

### 8.1 視覚的配慮
- **フォントサイズ**：最小16px
- **タッチターゲット**：最小44px×44px
- **コントラスト比**：4.5:1以上
- **色覚異常対応**：色以外の識別方法併用

### 8.2 操作支援
- **音声読み上げ**：各項目に適切なラベル設定
- **キーボードナビゲーション**：Tab移動対応
- **拡大表示**：システムの文字サイズ設定に追従

## 9. パフォーマンス要件

### 9.1 応答速度
- **画面表示**：1秒以内
- **テンキー入力**：即座反応（100ms以内）
- **カテゴリ選択**：即座反応
- **登録処理**：3秒以内完了

### 9.2 オフライン対応
- **一時保存**：ローカルストレージ使用
- **登録処理**：オンライン復帰時に自動送信
- **状態表示**：「オフライン」「同期中」の明確な表示

## 10. 実装優先度

### 10.1 MVP（必須機能）
1. 基本的なテンキー入力
2. カテゴリ選択（固定4カテゴリ）
3. 日付選択（今日・昨日・カレンダー）
4. 基本バリデーション
5. 登録処理

### 10.2 フェーズ2
1. 音声入力機能
2. 定型文機能
3. カテゴリ追加機能
4. 下書き機能
5. 詳細なエラーハンドリング

### 10.3 フェーズ3
1. 学習機能（よく使うカテゴリの最適化）
2. クイック入力（過去データからの推測）
3. 高度なアクセシビリティ対応
4. パフォーマンス最適化